* version
#+BEGIN_SRC emacs-lisp
  (defun js/version ()
    "Provides the version number of the init file."
    (interactive)
    (message "init version 8"))
#+END_SRC

* credits

+ [[https://www.gnu.org/software/emacs/manual/][The Manual]]
+ [[https://github.com/howardabrams/dot-files/blob/master/emacs.org][Howard Abrams]]
+ [[https://github.com/Wilfred/.emacs.d/blob/gh-pages/init.org][Wilfred Hughes]]
+ [[https://github.com/hrs/dotfiles/blob/master/emacs/.emacs.d/configuration.org][Harry Schwartz]]
+ [[https://github.com/zamansky/using-emacs/blob/master/myinit.org][Mike Zamansky]]
+ [[https://www.masteringemacs.org/][Mickey Petersen]]

* package repositories

#+BEGIN_SRC emacs-lisp
  (require 'package)
  (setq package-archives
        '(("gnu" . "https://elpa.gnu.org/packages/")
          ("melpa" . "https://melpa.org/packages/")))
#+END_SRC


* bootstrap package manager

[[https://github.com/jwiegley/use-package][use-package]] [[https://melpa.org/#/use-package][MELPA]]

#+BEGIN_SRC emacs-lisp
  (package-initialize)
  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))

  (require 'use-package)
#+END_SRC


* hide unwanted mode information from mode line

[[https://github.com/myrjola/diminish.el][diminish]] [[https://melpa.org/#/diminish][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package diminish
    :ensure t
    )
#+END_SRC

* general

#+BEGIN_SRC emacs-lisp
  (setq visible-bell t)
  (setq confirm-kill-emacs #'y-or-n-p)
  (setq inhibit-startup-screen t)
  (setq initial-scratch-message nil)
  (setq visual-line-fringe-indicators t)
  (setq scroll-conservatively 10000)
  (setq scroll-preserve-screen-position t)
#+END_SRC

* display

#+BEGIN_SRC emacs-lisp
  (menu-bar-mode -1)
  (tool-bar-mode -1)
  (when window-system
    (scroll-bar-mode -1)
    (global-hl-line-mode 1))
#+END_SRC

* editing

+ If text is selected, typing deletes it.
+ Add newline to bottom of every file.
+ Prevent tab insertion.
+ Remove the warnings around capitalization functions.
+ Remove warning for using "a" in dired to find file and close dired buffer.
+ Remove warning for narrow to region.

#+BEGIN_SRC emacs-lisp
  (setq column-number-mode t)
  (delete-selection-mode t)
  (setq require-final-newline t)
  (setq-default indent-tabs-mode nil)
  (put 'upcase-region 'disabled nil)
  (put 'downcase-region 'disabled nil)
  (put 'dired-find-alternate-file 'disabled nil)
  (put 'narrow-to-region 'disabled nil)
#+END_SRC

* font

Matthew Butterick's [[https://mbtype.com/fonts/triplicate/][Triplicate]] font.  Also see online text [[https://practicaltypography.com/][Practical Typography]].

#+BEGIN_SRC emacs-lisp
  (when (member "Triplicate T4c" (font-family-list))
    (set-face-attribute 'default nil :font "Triplicate T4c"))
  (set-face-attribute 'default nil :height 240)
#+END_SRC

* spelling

#+BEGIN_SRC emacs-lisp
  (use-package flyspell
    :ensure t
    :diminish flyspell-mode

    :config
    (setq ispell-program-name "aspell"
          ispell-local-dictionary "en_US"
          ispell-dictionary "american"
          ispell-extra-args '("--sug-mode=ultra" "--lang=en_US")
          ispell-list-command "--list"))
#+END_SRC

* ElDoc

[[https://www.emacswiki.org/emacs/ElDoc][ElDoc]]

#+BEGIN_SRC emacs-lisp
  (use-package eldoc
    :diminish eldoc-mode)
#+END_SRC

* new scratch buffers

Functions come from Harry Schwartz.  Most workflows start with one of these.

#+BEGIN_SRC emacs-lisp
        (defun js/new-buffer-checked ()
            "Create and switch to a temporary scratch org buffer with a random
             name.  Include spell checking."
            (interactive)
            (switch-to-buffer (make-temp-name "scratch-"))
            (org-mode)
            (flyspell-mode)
            (visual-line-mode))

        (global-set-key (kbd "C-c f") 'js/new-buffer-checked)

        (defun js/new-bom ()
            "Create and switch bom scratch buffer"
            (interactive)
            (switch-to-buffer (make-temp-name "bom-"))
            (org-mode)
            (insert
  "#+HTML_HEAD: <style>body {font-size: xx-large;}</style>
  ,#+OPTIONS: html-postamble:nil
  ,#+TITLE:BOM
  ,#+ATTR_HTML: :border2 :rules all :frame border
  | ITEM | 0 | 1 | SUM |
  |------+---+---+-----|
  |      |   |   |   3 |
  ,#+TBLFM: $4=vsum($2..$3)"
      )
            (goto-char 194)
            (cd "~/org"))
#+END_SRC

* copy a date from the calendar into the kill ring

[[https://emacs.stackexchange.com/questions/41978/how-to-retrieve-the-date-under-the-cursor-in-emacs-calendar-as-the-format-day-mo][Stack Overflow]]

#+BEGIN_SRC emacs-lisp
  (defcustom calendar-copy-as-kill-format "%Y-%m-%d"
    "Format string for formatting calendar dates with `format-time-string'."
    :type 'string
    :group 'calendar)

  (defun calendar-copy-as-kill ()
    "Copy date at point as kill if region is not active.
  Delegate to `kill-ring-save' otherwise."
    (interactive)
    (if (use-region-p)
        (call-interactively #'kill-ring-save)
      (let ((date (calendar-cursor-to-date)))
        (when date
          (setq date (encode-time 0 0 0 (nth 1 date) (nth 0 date) (nth 2 date)))
          (kill-new (format-time-string calendar-copy-as-kill-format date))))))

  (defun my-calendar-mode-hook-fun ()
    "Let \[kill-ring-save] copy the date at point if region is not active."
    (local-set-key [remap kill-ring-save] #'calendar-copy-as-kill))

  (add-hook 'calendar-mode-hook #'my-calendar-mode-hook-fun)
#+END_SRC

* direct changes from customize into specific file

#+BEGIN_SRC emacs-lisp
  (setq custom-file (expand-file-name "custom.el" user-emacs-directory))
  (when (file-exists-p custom-file)
    (load custom-file))
#+END_SRC

* move temp files to temp directory

#+BEGIN_SRC emacs-lisp
  (setq backup-directory-alist
        `((".*" . ,temporary-file-directory)))
  (setq auto-save-file-name-transforms
        `((".*" ,temporary-file-directory t)))
#+END_SRC

* various mode hooks

#+BEGIN_SRC emacs-lisp
  (add-hook 'today-visible-calendar-hook 'calendar-mark-today)

  (add-hook 'python-mode-hook
       (lambda ()
         (display-line-numbers-mode 1)))

  (add-hook 'python-mode-hook
            (lambda ()
              (add-to-list 'write-file-functions 'delete-trailing-whitespace)))

  (add-hook 'dired-mode-hook
            (lambda ()
              (dired-hide-details-mode 1)))

  (add-hook 'eshell-mode-hook
            (lambda ()
              (abbrev-mode 1)
              (display-line-numbers-mode 1)))

  (add-hook 'org-mode-hook
            (lambda ()
              (visual-line-mode 1)))
#+END_SRC

* enable recent file tracking

[[https://www.masteringemacs.org/article/find-files-faster-recent-files-package][Mastering Emacs]]

#+BEGIN_SRC emacs-lisp
  (recentf-mode t)
  (setq recentf-max-saved-items 150)
  (global-set-key (kbd "C-x C-r") 'recentf-open-files)
#+END_SRC

* duplicate a line

[[https://stackoverflow.com/a/998472][Stack Overflow]]
Using the [[https://github.com/bbatsov/crux][crux]] implementation.  See section below.

#+BEGIN_SRC emacs-lisp
  (defun js/duplicate-line (arg)
    "Duplicate current line, leaving point in lower line."
    (interactive "*p")

    ;; save the point for undo
    (setq buffer-undo-list (cons (point) buffer-undo-list))

    ;; local variables for start and end of line
    (let ((bol (save-excursion (beginning-of-line) (point)))
          eol)
      (save-excursion

        ;; don't use forward-line for this, because you would have
        ;; to check whether you are at the end of the buffer
        (end-of-line)
        (setq eol (point))

        ;; store the line and disable the recording of undo information
        (let ((line (buffer-substring bol eol))
              (buffer-undo-list t)
              (count arg))
          ;; insert the line arg times
          (while (> count 0)
            (newline)         ;; because there is no newline in 'line'
            (insert line)
            (setq count (1- count)))
          )

        ;; create the undo information
        (setq buffer-undo-list (cons (cons eol (point)) buffer-undo-list)))
      ) ; end-of-let

    ;; put the point in the lowest line and return
    (next-line arg))
#+END_SRC

* delete a line without killing it

[[https://stackoverflow.com/a/35711240][Stack Overflow]]

#+BEGIN_SRC emacs-lisp
  (defun js/delete-current-line ()
    "Delete (not kill) the current line."
    (interactive)
    (save-excursion
      (delete-region
       (progn (forward-visible-line 0) (point))
       (progn (forward-visible-line 1) (point)))))

  (global-set-key (kbd "C-c <deletechar>") 'js/delete-current-line)
#+END_SRC

* copy active region to Windows clipboard

[[https://www.reddit.com/r/emacs/comments/6xryqh/emacs_in_wsl_and_the_windows_clipboard/][Reddit]]

#+BEGIN_SRC emacs-lisp
  (defun js/wsl-copy ()
    (interactive)
    (let ((default-directory "/mnt/c/"))
      (shell-command-on-region (point-min) (point-max) "clip.exe")))
#+END_SRC

* org mode housekeeping

Inspired by Karl Voit's [[https://karl-voit.at/2014/08/10/bookmarks-with-orgmode/][post]], started using org mode for storing bookmarks.  Abrams also
discusses capture templates extensively.  His gentle introduction is  [[http://howardism.org/Technical/Emacs/capturing-intro.html][here]].

I don't want to confirm every time babel evaluates.

#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files (quote ("~/org/ephemera.org" "~/org/kanban.org" "~/org/notes.org")))
  (setq org-export-with-toc nil)
  (setq org-html-postamble nil)
  (setq org-cycle-separator-lines 1)
  (setq org-confirm-babel-evaluate nil)
  (setq org-publish-project-alist
        '(("keyboard"
           :base-directory "~/notes/"
           :exclude "org"
           :include ("keyboard.org")
           :publishing-function org-html-publish-to-html
           :publishing-directory "~/org/html")))

  (setq org-capture-templates
     (quote
      (("e" "TODO ephemera" entry
        (file "~/org/ephemera.org")
        "* TODO %?\nSCHEDULED: %t")
       ("b" "bookmark clipped link" entry
        (file "~/org/notes.org")
        "* [[%x]] %?\n:PROPERTIES:\n:CREATED: %U\n:END:\n"
        :empty-lines 1)
       ("f" "blood pressure" table-line
        (file "~/org/bp.org")
        "| %^{date}U | %^{sys} | %^{dia} | %^{pulse}")
       )))

  (global-set-key (kbd "C-c c") 'org-capture)

  (add-to-list 'org-structure-template-alist
               '("E" "#+BEGIN_SRC emacs-lisp\n?\n#+END_SRC"))

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     (python . t)))
#+END_SRC

* navigation within a file

[[https://github.com/abo-abo/avy][avy]] [[https://melpa.org/#/avy][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package avy
    :ensure t
    :bind ("C-c j" . avy-goto-char-timer))
#+END_SRC


* expand region based on context

[[https://github.com/magnars/expand-region.el][expand-region]] [[https://melpa.org/#/expand-region][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package expand-region
    :ensure t
    :bind ("C-=" . er/expand-region))
#+END_SRC


* snippets

[[https://github.com/joaotavora/yasnippet][yasnippet]] [[https://melpa.org/#/yasnippet][MELPA]] [[https://github.com/AndreaCrotti/yasnippet-snippets][yasnippet-snippets]] [[https://melpa.org/#/yasnippet-snippets][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
      :ensure t
      :diminish yas-minor-mode
      :hook
      (prog-mode . yas-minor-mode))
#+END_SRC

* quick snippets

[[https://github.com/abo-abo/auto-yasnippet][auto-yasnippet]] [[https://melpa.org/#/auto-yasnippet][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package auto-yasnippet
    :ensure t
    :bind (("C-c w" . aya-create)
           ("C-c y" . aya-expand)))
#+END_SRC


* editing helpers

[[https://github.com/bbatsov/crux][crux]] [[https://melpa.org/#/crux][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package crux
    :ensure t
    :bind (("C-a" . crux-move-beginning-of-line)
           ("S-<return>" . crux-smart-open-line)
           ("C-c d" . crux-duplicate-current-line-or-region)
           ("C-c M-d" . crux-duplicate-and-comment-current-line-or-region)
           ("C-x 4 t" . crux-transpose-windows)
           ("C-c t" . crux-visit-term-buffer)))
#+END_SRC

* testing packages

[[https://github.com/larstvei/Try][try]] [[https://melpa.org/#/try][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package try
    :ensure t)
#+END_SRC

* nicer help

[[https://github.com/Wilfred/helpful][helpful]] [[https://melpa.org/#/helpful][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package helpful
    :ensure t)
#+END_SRC

* disable mouse

[[https://github.com/purcell/disable-mouse/tree/541363bd6353b8b05375552bab884a6315ea545c][disable-mouse]] [[https://melpa.org/#/disable-mouse][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package disable-mouse
    :ensure t
    :diminish disable-mouse-global-mode
    :config
    (global-disable-mouse-mode))
#+END_SRC

* ibuffer

Mike Zamansky [[https://github.com/zamansky/using-emacs/blob/master/myinit.org][init]] [[https://cestlaz-nikola.github.io/posts/using-emacs-34-ibuffer-emmet/#.W6evkrQpA5k][video]]

#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-x C-b") 'ibuffer)
  (setq ibuffer-saved-filter-groups
        (quote (("default"
                 ("dired" (mode . dired-mode))
                 ("org" (mode . org-mode))
                 ("python" (mode . python-mode))
                 ("elisp" (mode . emacs-lisp-mode))
                 ("html" (mode . mhtml-mode))
                 ("css" (mode . css-mode))
                 ("javascript" (mode . js-mode))
                 ("exwm" (mode . exwm-mode))
                 ("eshell" (mode . eshell-mode))
                 ("magit" (mode . magit-status-mode))))))
  (add-hook 'ibuffer-mode-hook
            (lambda ()
              (ibuffer-auto-mode 1)
              (ibuffer-switch-to-saved-filter-groups "default")))
  (setq ibuffer-show-empty-filter-groups nil)
#+END_SRC

* smartparens

[[https://github.com/Fuco1/smartparens][smartparens]] [[http://melpa.org/#/smartparens][MELPA]]

Helpful blog post [[https://ebzzry.io/en/emacs-pairs/][here]].

Instructions on disabling inch marks in org mode are [[https://github.com/Fuco1/smartparens/wiki/Permissions][here]].

#+BEGIN_SRC emacs-lisp
  (use-package smartparens-config
    :ensure smartparens
    :diminish smartparens-mode
    :config
    (smartparens-global-mode t)
    (show-smartparens-global-mode t)
    (sp-local-pair 'org-mode "\"" "\"" :actions nil)
    (sp-local-pair 'message-mode "\"" "\"" :actions nil))
#+END_SRC

* ivy

[[https://github.com/abo-abo/swiper][Ivy]] [[https://melpa.org/#/counsel][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package counsel
    :ensure t
    :diminish counsel-mode
    :bind
    ("M-y" . counsel-yank-pop)
    ("M-x" . counsel-M-x)
    ("C-x C-f" . counsel-find-file))

  (use-package ivy
    :ensure t
    :diminish ivy-mode
    :bind
    ("C-x b" . ivy-switch-buffer)
    :config
    (ivy-mode 1)
    (counsel-mode 1)
    (setq ivy-use-virtual-buffers t)
    (setq ivy-display-style 'fancy))

  (use-package swiper
    :ensure t
    :bind
    ("C-s" . swiper))
#+END_SRC

* upcase table

#+BEGIN_SRC emacs-lisp
  (defun js/upcase-table ()
    "Makes all text in an org table upper case."
    (interactive)
    (when (org-at-table-p)
      (upcase-region (org-table-begin) (org-table-end))))
#+END_SRC

* mail

#+BEGIN_SRC emacs-lisp
  (use-package sendmail
    :commands
    (mail-send)
    :init
    (setq mailclient-place-body-on-clipboard-flag nil)
    (setq message-kill-buffer-query nil)
    (setq send-mail-function (quote mailclient-send-it))
    (setq message-required-headers (quote ((optional . References))))
    (defun js/mail-send-and-kill ()
      (interactive)
      (set-visited-file-name nil t)
      (mail-send)
      (message-kill-buffer))
    (add-hook 'message-mode-hook
              (lambda ()
                (define-key message-mode-map (kbd "C-c s")
                  'js/mail-send-and-kill)))
    :hook
    ((message-mode . turn-on-orgtbl)
     (message-mode . turn-on-orgstruct++)
     (message-mode . turn-off-auto-fill)
     (message-mode . turn-on-flyspell))
  )
#+END_SRC

* recentf-ext

This [[https://twitter.com/xenodium/status/1082020496466690048][tweet]] from Alvaro Ramirez came right when I was thinking about how to quickly get to directories without using bookmarks.

[[https://github.com/rubikitch/recentf-ext/tree/450de5f8544ed6414e88d4924d7daa5caa55b7fe][recentf-ext]] [[https://melpa.org/#/recentf-ext][MELPA]]

#+BEGIN_SRC emacs-lisp
  (use-package recentf-ext
    :ensure t)
#+END_SRC

* store job numbers in registers

#+BEGIN_SRC emacs-lisp
  (defun js/set-job-register (job)
    (interactive "sJob: ")
    (let ((job (upcase job)))
      (set-register ?j job)
      (set-register ?J (concat job " SPECIAL PARTS.pdf"))))
#+END_SRC

* make comma separated lists of tags

[[https://stackoverflow.com/questions/17922208/emacs-convert-items-on-separate-lines-to-a-comma-separated-list][Stack Overflow]]

#+BEGIN_SRC emacs-lisp
  (defun js/sort-comma (reverse beg end)
    "Take a list of tags one per line, capitalize them, sort them,
     then replace the line breaks with commas."
    (interactive "P\nr")
    (upcase-region beg end)
    (sort-lines reverse beg end)
    (save-excursion
      (save-restriction
        (narrow-to-region beg end)
        (end-of-buffer)
        (beginning-of-line)
        (insert "and ")
        (beginning-of-buffer)
        (while (search-forward "\n" nil t)
          (replace-match ", "))
        )))
#+END_SRC

* ace-window

[[https://github.com/abo-abo/ace-window][ace-window]] [[https://melpa.org/#/ace-window][MELPA]]

[[https://youtu.be/D6OUMVbPKSA][Mike Zamansky video]]
[[https://youtu.be/nKCKuRuvAOw][Sacha Chua video]]

#+BEGIN_SRC emacs-lisp
  (use-package ace-window
    :ensure t
    :config
    (setq aw-keys '(?a ?s ?d ?f ?k ?l ?\;))
    (setq aw-char-position (quote left))
    (custom-set-faces
     '(aw-leading-char-face ((t (:foreground "red" :height 3.0)))))
    :bind ("<f16>" . ace-window))
#+END_SRC

* stripe region or table

#+BEGIN_SRC emacs-lisp
  (defvar js-hi '(:background "gainsboro"))

  (defun js/stripe-region (start end)
    "Stripe alternate lines of region."
    (interactive "r")
    (save-excursion
      (goto-char start)
      (while (< (point) end)
        (let ((o (make-overlay (line-beginning-position) (line-end-position))))
          (overlay-put o 'js t)
          (overlay-put o 'face js-hi))
        (forward-line 2))))

  (defun js/stripe-table ()
    "Stripe alternate lines of org-table"
    (interactive)
    (when (org-at-table-p)
      (js/stripe-region (org-table-begin) (org-table-end))))

  (defun js/stripe-remove ()
    "Remove stripes."
    (interactive)
    (remove-overlays nil nil 'js t))
#+END_SRC

* pinned buffer minor mode

Wrapper for easily pinning a buffer to a window.  Found it [[https://github.com/carrete/.emacs.d/blob/master/lisp/setup-pinned-buffer-mode.el][here]].  Still working on window management in emacs.

#+BEGIN_SRC emacs-lisp
  (define-minor-mode pinned-buffer-mode
    "Pin the current buffer to the selected window."
    nil " P" nil
    (set-window-dedicated-p (selected-window) pinned-buffer-mode))

  (global-set-key (kbd "C-c p") 'pinned-buffer-mode)

  (provide 'setup-pinned-buffer-mode)
#+END_SRC

* split window functions
#+BEGIN_SRC emacs-lisp
  (defun js/split-right-34 ()
    "Splits window right using three quarters of the available space."
    (interactive)
    (split-window-right (floor (* .75 (window-total-width)))))

  (defun js/split-below-34 ()
    "Splits window below using three quarters of the available space."
    (interactive)
    (split-window-below (floor (* .75 (window-total-height)))))
#+END_SRC
